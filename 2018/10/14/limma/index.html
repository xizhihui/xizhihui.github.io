<!DOCTYPE html>
<html>
<head>
	<title>XZH's Notes</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="author" content="xizhihui" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="stylesheet" type="text/css" href="/statics/reset.css">
	<link rel="stylesheet" type="text/css" href="/statics/header_footer.css"></link>
	<link rel="stylesheet" type="text/css" href="/statics/default.css">
	<link rel="stylesheet" type="text/css" href="/statics/main.css">
</head>
<body>
	<header class="Header">
		<nav>
			<h3>XZH</h3>
			<ul>
				<li><a href="/index.html#Timeline">Timeline</a></li><li><a href="/index.html#Category">Category</a></li><li><a href="/index.html#Tags">Tags</a></li><li><a href="/index.html#About">About</a></li>
			</ul>
		</nav>
	</header>
	<div class="Motto">
		<h2>XZH's Notes</h2>
		<h4>The future comes for you ~ ~ ~</h4>
	</div>

	<main>
		<nav id="table"></nav>
		<content id="content" class="content">
			<h2 id="limma">limma</h2>
<p>limma最开始是用于芯片数据分析的,不过现在也支持RNA-seq等数据的差异分析，但是需要通过voom函数进行校正表达矩阵。</p>
<h3 id="_1">分析芯片数据</h3>
<p>在limma芯片数据分析的过程中,有需要注意的一个地方,那就是分组矩阵和差异比较矩阵的问题,使用差异比较矩阵时的代码是有不一样的,结果仍旧相同,当然你要指定好makeContrasts的参数咯.</p>
<p>使用topTable时,coef是用来指定提取特定比较的结果.例如你在design的时候,1-2的比较,coef可以设置为'1-2'.如果不是用差异比较矩阵,coef=1就是分组矩阵的column1-column2,以此类推</p>
<h4 id="_2">不使用差异比较矩阵</h4>
<div class="codehilite"><pre><span></span><span class="kn">library</span><span class="p">(</span>limma<span class="p">)</span>
groups <span class="o">=</span> <span class="kp">sort</span><span class="p">(</span><span class="kp">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">))</span>
<span class="kp">names</span><span class="p">(</span>groups<span class="p">)</span> <span class="o">=</span> level<span class="p">(</span><span class="kp">factor</span><span class="p">(</span>groups<span class="p">))</span>
design <span class="o">=</span> model.matrix<span class="p">(</span><span class="o">~</span><span class="kp">factor</span><span class="p">(</span>groups<span class="p">))</span>
fit.lm <span class="o">=</span> lmfit<span class="p">(</span>expr<span class="p">,</span> design<span class="p">)</span>
fit.ebs <span class="o">=</span> eBayes<span class="p">(</span>fit.lm<span class="p">)</span>
topTable<span class="p">(</span>fit.ebs<span class="p">,</span> adjust<span class="o">=</span><span class="s">&#39;BH&#39;</span><span class="p">,</span> coef<span class="o">=</span><span class="m">2</span><span class="p">,</span> lfc<span class="o">=</span><span class="m">1</span><span class="p">,</span> p.value<span class="o">=</span><span class="m">0.05</span><span class="p">,</span> numbers<span class="o">=</span><span class="m">30000</span><span class="p">)</span>
<span class="c1"># 输出所有的差异分析结果</span>
results <span class="o">=</span> desideTests<span class="p">(</span>fit.ebs<span class="p">)</span>
</pre></div>


<h4 id="_3">使用差异比较矩阵</h4>
<div class="codehilite"><pre><span></span>groups <span class="o">=</span> <span class="kp">sort</span><span class="p">(</span><span class="kp">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">))</span>
design <span class="o">=</span> model.matrix<span class="p">(</span><span class="o">~</span> <span class="m">0</span> <span class="o">+</span> <span class="kp">factor</span><span class="p">(</span>groups<span class="p">))</span>
<span class="kp">colnames</span><span class="p">(</span>design<span class="p">)</span> <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">,</span><span class="s">&#39;2&#39;</span><span class="p">,</span><span class="s">&#39;3&#39;</span><span class="p">)</span>
fit.lm <span class="o">=</span> lmfit<span class="p">(</span>expr<span class="p">,</span> design<span class="p">)</span>
contrast <span class="o">=</span> makeContrasts<span class="p">(</span><span class="s">&#39;1-2&#39;</span><span class="p">,</span> <span class="s">&#39;1-3&#39;</span><span class="p">,</span> <span class="s">&#39;2-3&#39;</span><span class="p">,</span> levels<span class="o">=</span>design<span class="p">)</span>
fit.cts <span class="o">=</span> contrasts.fit<span class="p">(</span>fit.lm<span class="p">,</span> contrast<span class="p">)</span>
fit.ebs <span class="o">=</span> eBayes<span class="p">(</span>fit.cts<span class="p">)</span>
<span class="c1"># 选取top的基因查看</span>
topTable<span class="p">((</span>fit.ebs<span class="p">,</span> adjust<span class="o">=</span><span class="s">&#39;BH&#39;</span><span class="p">,</span> coef<span class="o">=</span><span class="m">2</span><span class="p">,</span> lfc<span class="o">=</span><span class="m">1</span><span class="p">,</span> p.value<span class="o">=</span><span class="m">0.05</span><span class="p">,</span> numbers<span class="o">=</span><span class="m">30000</span><span class="p">)</span>
<span class="c1"># 输出所有的差异分析结果</span>
results <span class="o">=</span> desideTests<span class="p">(</span>fit.ebs<span class="p">)</span>
</pre></div>


<h3 id="rna-seq">分析RNA-seq数据</h3>
<p>用于差异分析的RNA-seq数据必需是raw_counts数据.</p>
<div class="codehilite"><pre><span></span><span class="kp">suppressMessages</span><span class="p">(</span><span class="kn">library</span><span class="p">(</span>limma<span class="p">))</span>
<span class="c1"># 构建分组矩阵</span>
expr_matrix <span class="o">=</span> your_expr_matrix
groups <span class="o">=</span> your_groups
design <span class="o">=</span> model.matrix<span class="p">(</span><span class="o">~</span><span class="kp">factor</span><span class="p">(</span>group_list<span class="p">))</span>
<span class="kp">colnames</span><span class="p">(</span>design<span class="p">)</span> <span class="o">=</span> <span class="kp">levels</span><span class="p">(</span><span class="kp">factor</span><span class="p">(</span>group_list<span class="p">))</span>
<span class="kp">rownames</span><span class="p">(</span>design<span class="p">)</span> <span class="o">=</span> <span class="kp">colnames</span><span class="p">(</span>expr_matrix<span class="p">)</span>

<span class="c1"># 进行校正</span>
v <span class="o">=</span> voom<span class="p">(</span>expr_matrix<span class="p">,</span> design<span class="p">,</span> normalize<span class="o">=</span><span class="s">&#39;quantile&#39;</span><span class="p">)</span>

<span class="c1"># 进行差异分析</span>
fit.lm <span class="o">=</span> lmFit<span class="p">(</span>v<span class="p">,</span> design<span class="p">)</span>
fit.ebs <span class="o">=</span> eBayes<span class="p">(</span>fit.lm<span class="p">)</span>
DE.genes <span class="o">=</span> topTable<span class="p">(</span>fit.ebs<span class="p">,</span> coef<span class="o">=</span><span class="m">2</span><span class="p">,</span> n<span class="o">=</span><span class="kc">Inf</span><span class="p">,</span> lfc<span class="o">=</span><span class="m">1</span><span class="p">,</span> p.value<span class="o">=</span><span class="m">0.05</span><span class="p">)</span>
</pre></div>


<h3 id="_4">结果说明</h3>
<ul>
<li>topTable用于提取top基因和对应的contrast</li>
<li>logFC是log fold change</li>
<li>aveExpr是average log2-expression level for gene in all array</li>
<li>pvalue/adj.p.value是p-value和校正后的p-value</li>
<li>t 是 moderated t-statistic</li>
<li>B 假设B=1.5,则exp(1.5)=4.48,因此基因出现差异表达的可能性为4.48/(1+4.48)=0.8</li>
</ul>
		</content>

	</main>
	<footer>
		<p> Powered by xizhihui </p>
		<p> Thanks to <a href="https://www.hifreud.com/">hifreud</a> the theme is learned from his site. </p>
	</footer>

<script type="text/javascript" src="/js/index.json"></script>
<script type="text/javascript" src="/js/category.json"></script>
<script type="text/javascript" src="/js/tags.json"></script>
<script type="text/javascript" src="/js/about.json"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript">
	// listen to click event on navigator in header
	// document
	// 	.querySelector("div#head_right ul")
	// 	.addEventListener("click", change_page)
	var table = [['h2', 'limma', 'limma'], ['h3', '_1', '分析芯片数据'], ['h4', '_2', '不使用差异比较矩阵'], ['h4', '_3', '使用差异比较矩阵'], ['h3', 'rna-seq', '分析RNA-seq数据'], ['h3', '_4', '结果说明']]
	var html = format_article_table(table)
	var table_ele = document.querySelector("main #table")
	table_ele.innerHTML = html
	// window.onload = evt => resize_nav(table_ele)
	adaption(document, window)

</script>
</body>
</html>