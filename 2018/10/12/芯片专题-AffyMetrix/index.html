<!DOCTYPE html>
<html>
<head>
	<title>XZH's Notes</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="author" content="xizhihui" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="stylesheet" type="text/css" href="/statics/reset.css">
	<link rel="stylesheet" type="text/css" href="/statics/header_footer.css"></link>
	<link rel="stylesheet" type="text/css" href="/statics/default.css">
	<link rel="stylesheet" type="text/css" href="/statics/main.css">
</head>
<body>
	<header class="Header">
		<nav>
			<h3>XZH</h3>
			<ul>
				<li><a href="/index.html#Timeline">Timeline</a></li><li><a href="/index.html#Category">Category</a></li><li><a href="/index.html#Tags">Tags</a></li><li><a href="/index.html#About">About</a></li>
			</ul>
		</nav>
	</header>
	<div class="Motto">
		<h2>XZH's Notes</h2>
		<h4>The future comes for you ~ ~ ~</h4>
	</div>

	<main>
		<nav id="table"></nav>
		<content id="content" class="content">
			<h2 id="_1">一、芯片基础</h2>
<h3 id="11">1.1 芯片平台和包</h3>
<table>
<thead>
<tr>
<th>平台</th>
<th>包</th>
</tr>
</thead>
<tbody>
<tr>
<td>illumina</td>
<td>beadarray, lumi</td>
</tr>
<tr>
<td>affymatrix</td>
<td>affy,simpleaffy, oligo</td>
</tr>
<tr>
<td>agilent</td>
<td>没有找到</td>
</tr>
</tbody>
</table>
<h3 id="12-bioconductor">1.2 bioconductor包内置芯片数据</h3>
<blockquote>
<p>http://www.bio-info-trainee.com/1399.html</p>
</blockquote>
<h3 id="13-geo">1.3 GEO数据库</h3>
<ul>
<li>GEO platform: GPL</li>
<li>GEO sample:   GSM</li>
<li>GEO series:   GSE</li>
<li>GEO dataset:  GDS</li>
</ul>
<p>处理GEO数据有两条思路,第一条速录是利用GEOquery来下载。另一条则是自己下载原始的芯片数据，然后转换成表达矩阵.当然，有些比较常用的芯片则是有对应的包,我们只需要把对应包进行安装就有相应的芯片数据了。</p>
<h4 id="131-geoquery">1.3.1 GEOquery</h4>
<p>getGEO(GEOID, destdir):
+ GDS858:   下载数据集
+ GPL96：    下载芯片设计信息,probe-geneID对应表(soft文件)
+ GSE1009:  下载表达矩阵,在下载该数据时GPL96.soft也会自动下载,但无法读取.得用GPL96作为ID使用getGEO函数.这时候的getGPL干脆设为False</p>
<p>getGEOfile:      下载GEO soft文件
getGEOSuppFiles: 下载原始数据</p>
<div class="codehilite"><pre><span></span># 使用GDS858的ID下载
GDS = getGEO(&#39;GDS858&#39;, destdir=&#39;.&#39;)
expr_matrix = Table(GDS)    #得到表达矩阵
Des_info = Meta(GDS)        #得到描述信息(metadata)
eSet = GDS2eSet(GDS, do.log2=T) #得到expressionSet,做log2变换

# 使用GSE1009的ID下载
# 返回的是含expressionSet对象的list
genes = geneNames(GSE[[1]])     # 得到gene名, geneNames是biobase包里面的
samples = sampleNames(GSE[[1]]) # 得到样品名
pdata = pData(GSE[[1]])         # 得到描述信息(metadata)
expr_matrix = exprs(GSE[[1]])   # 得到表达矩阵

# GPL16699的ID下载
Des_info = Meta(GPL)        # 得到描述信息
Annotation = Table(GPL)     # 得到芯片注释信息(geneID-probeID)

# 下载原始数据信息
rawdata = getGEOSuppFiles(GSE1009)
</pre></div>


<h4 id="132-geo">1.3.2 GEO页面</h4>
<p><img alt="P3GY5j.png" src="https://s1.ax1x.com/2018/07/19/P3GY5j.png" /></p>
<h3 id="14">1.4 原始数据的预处理</h3>
<ol>
<li>
<p>背景信号处理
由于图像处理软件对芯片划格后,取杂交点周围区域内每个像素的吸光度均值作为背景信号,但是芯片的不同区域像素不同则均值不同,各个区域扣除的背景则多少不一.所以要进行背景信号处理. 可以利用芯片最低信号轻度的点作为背景信号,或者把芯片非杂交点的背景吸光度均值作为整个芯片的背景信号.</p>
</li>
<li>
<p>芯片数据清理
经背景校正后的芯片数据会出现异常值,通常的处理方法就是去除这些异常值,去除的方法有:标准值法, 奇异值法, 变异系数法, 前景值法(front value &lt;200), 中位数法等等.Affymetrix的芯片则时直接将负值修正为一个固定值.</p>
</li>
</ol>
<p>紧接着,对于缺失值的处理,方法有多种.一个时删除, 如果某行或某列的缺失值多于某个阈值,则删除该行/列. 另一种是补全.补全值的选择有使用0值补全,使用均值或中值补全,还可以时K邻近法进行补全.</p>
<ol>
<li>
<p>归一化
由于芯片数据值变化很大, 呈偏态,标准差大.但是后续的差异分析基本都是假定数据的正态分布,所以可以使用对数转换使数据趋于正态分布, 减少标准差.然后是消除技术误差/偏差.这时候使用的方法有平均数标准化, 中位数标准化等方法.此时就得到了表达矩阵.</p>
</li>
<li>
<p>差异分析
芯片数据的差异分析有三种方法：</p>
</li>
<li>倍数分析法(fold change)</li>
<li>参数检验(t-test)</li>
<li>非参数检验(经验贝叶斯,SAM法)</li>
</ol>
<p>常用的软件有:limma、DESeq2、edgeR、GFOLD等。</p>
<h2 id="affy">二、使用Affy包分析芯片质量</h2>
<div class="codehilite"><pre><span></span><span class="kn">source</span><span class="p">(</span><span class="s">&#39;http://biconductor.org/biocLite.R&#39;</span><span class="p">)</span>
biocLite<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;affy&#39;</span><span class="p">,</span> <span class="s">&#39;simpleaffy&#39;</span><span class="p">))</span>
</pre></div>


<h3 id="21-cel">2.1 读取CEL文件,查看基本信息</h3>
<div class="codehilite"><pre><span></span><span class="kp">suppressPackageStartupMessages</span><span class="p">({</span>
    <span class="kn">library</span><span class="p">(</span>affy<span class="p">))</span>
    <span class="kn">library</span><span class="p">(</span>simpleaffy<span class="p">))</span>

<span class="c1">###################读取文件####################</span>
filenames <span class="o">=</span> <span class="kp">list.files</span><span class="p">(</span><span class="s">&#39;./GSE30668&#39;</span><span class="p">,</span> pattern<span class="o">=</span><span class="s">&#39;*.CEL&#39;</span><span class="p">)</span>
the.data <span class="o">=</span> ReadAffy<span class="p">(</span>filenames<span class="o">=</span><span class="kp">paste0</span><span class="p">(</span><span class="s">&#39;./GSE30668/&#39;</span><span class="p">,</span> filenames<span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">))</span>

<span class="c1">##############芯片基本信息####################</span>
old.names <span class="o">=</span> sampleNames<span class="p">(</span>the.data<span class="p">)</span> <span class="c1"># 芯片名</span>
sampleNames<span class="p">(</span>the.data<span class="p">)</span> <span class="o">=</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&#39;.CEL&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> filenames<span class="p">)</span>

<span class="c1"># 完美匹配探针,错配探针; perfect match probes / mismatch probes</span>
pm.data <span class="o">=</span> pm<span class="p">(</span>the.data<span class="p">)</span>
mm.data <span class="o">=</span> mm<span class="p">(</span>the.data<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>pm.data<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>mm.data<span class="p">)</span>

pdata <span class="o">=</span> pData<span class="p">(</span>the.data<span class="p">)</span>
probes <span class="o">=</span> geneNames<span class="p">(</span>the.data<span class="p">)</span>
</pre></div>


<h3 id="22">2.2 查看芯片质量</h3>
<ul>
<li>灰度图、灰度值</li>
</ul>
<div class="codehilite"><pre><span></span>nmatrix <span class="o">=</span> <span class="kp">length</span><span class="p">(</span>filenames<span class="p">)</span>

<span class="c1">#################### 画灰度图,并统计灰度值 ######################</span>
par<span class="p">(</span>mfrow<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="kp">ceiling</span><span class="p">(</span>nmatrix<span class="o">/</span><span class="m">2</span><span class="p">),</span> <span class="m">2</span><span class="p">))</span>
par<span class="p">(</span>mar<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.2</span><span class="p">))</span>
<span class="c1"># 设置调色板为灰度</span>
pallette.gray <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="kp">grep</span><span class="p">(</span>gray<span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">10</span><span class="o">/</span><span class="m">10</span><span class="p">),</span> times<span class="o">=</span><span class="kp">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">41</span><span class="p">,</span>by<span class="o">=</span><span class="m">4</span><span class="p">)))</span>

<span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span>nmatrix<span class="p">)</span> <span class="p">{</span>
    image<span class="p">(</span>the.data<span class="p">[,</span> i<span class="p">],</span> col<span class="o">=</span>pallette.gray<span class="p">)</span>
    <span class="c1"># 如果芯片图像有版斑块就有可能时坏片</span>
<span class="p">}</span>
par<span class="p">(</span>mfrow<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
par<span class="p">(</span>mar<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">0.5</span><span class="p">))</span>
par<span class="p">(</span>cex<span class="o">=</span><span class="m">0.7</span><span class="p">)</span>
<span class="kr">if</span> <span class="p">(</span>nmatrix <span class="o">&gt;</span> <span class="m">40</span><span class="p">)</span> par<span class="p">(</span>cex<span class="o">=</span><span class="m">0.5</span><span class="p">)</span>
colors <span class="o">=</span> rainbow<span class="p">(</span>nmatrix<span class="o">*</span><span class="m">1.2</span><span class="p">)</span>
boxplot<span class="p">(</span>the.data<span class="p">,</span> col<span class="o">=</span>colors<span class="p">,</span> xlab<span class="o">=</span><span class="s">&#39;Sample&#39;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&#39;Log intensity&#39;</span><span class="p">)</span>
</pre></div>


<ul>
<li>曲线图，MA-plot，RNA降解分析</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c1">##################### 画曲线图 ######################</span>
par<span class="p">(</span>mar<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">0.5</span><span class="p">))</span>
hist<span class="p">(</span>the.data<span class="p">,</span> lty<span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> col<span class="o">=</span>colors<span class="p">)</span>
legend<span class="p">(</span><span class="s">&#39;topright&#39;</span><span class="p">,</span> legend<span class="o">=</span>sampleNames<span class="p">(</span>the.data<span class="p">),</span>
        lty<span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> col<span class="o">=</span>colors<span class="p">,</span> 
        box.col<span class="o">=</span><span class="s">&#39;white&#39;</span><span class="p">,</span> xpd<span class="o">=</span><span class="bp">T</span><span class="p">,</span>
        cex<span class="o">=</span><span class="m">1.5</span><span class="p">)</span>
box<span class="p">()</span>

<span class="c1">####################### MA-plot #####################</span>
<span class="c1"># 作图得到IQR,如果IQR较大的话芯片可能有问题</span>
par<span class="p">(</span>mfrow<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="kp">ceiling</span><span class="p">(</span>nmatrix<span class="o">/</span><span class="m">2</span><span class="p">),</span> <span class="m">2</span><span class="p">))</span>
par<span class="p">(</span>mar<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">0.5</span><span class="p">))</span>
par<span class="p">(</span>tcl<span class="o">=</span><span class="m">0.2</span><span class="p">)</span>
par<span class="p">(</span>mgp<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">0</span><span class="p">))</span>
MAplot<span class="p">(</span>the.data<span class="p">,</span> cex<span class="o">=</span><span class="m">0.8</span><span class="p">)</span>

<span class="c1">####################### RNA降解分析 #################</span>
<span class="c1"># 理想情况下每个样品的线(分段)是平行的</span>
par<span class="p">(</span>mfrow<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
par<span class="p">(</span>mar<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">0.5</span><span class="p">))</span>
RNAdeg <span class="o">=</span> AffyRNAdeg<span class="p">(</span>the.data<span class="p">)</span>
summaryAffyRNAdeg<span class="p">(</span>RNAdeg<span class="p">)</span>
plotAffyRNAdeg<span class="p">(</span>RNAdeg<span class="p">,</span> cols<span class="o">=</span>colors<span class="p">)</span>
legend<span class="p">(</span><span class="s">&#39;topleft&#39;</span><span class="p">,</span> legend<span class="o">=</span>sampleNames<span class="p">(</span>the.data<span class="p">),</span>
        lty<span class="o">=</span><span class="m">1</span><span class="p">,</span> col<span class="o">=</span>colors<span class="p">,</span>
        box.col<span class="o">=</span><span class="s">&#39;white&#39;</span><span class="p">,</span> xpd<span class="o">=</span><span class="bp">T</span><span class="p">)</span>
box<span class="p">()</span>
</pre></div>


<ul>
<li>背景信号值、样品缩放因子、阳性信号值（表达基因占比，内参占比）</li>
</ul>
<div class="codehilite"><pre><span></span><span class="kp">suppressPackageStartupMessages</span><span class="p">(</span><span class="kn">library</span><span class="p">(</span>simpleaffy<span class="p">))</span>

<span class="c1">################# 查看背景信号值 ####################</span>
<span class="c1"># 如果背景信号值太大,说明芯片结果并不好(太大是多大?)</span>
qc.data <span class="o">=</span> qc<span class="p">(</span>the.data<span class="p">)</span>
avbg.data <span class="o">=</span> <span class="kp">as.data.frame</span><span class="p">(</span><span class="kp">sort</span><span class="p">(</span>avbg<span class="p">(</span>qc.data<span class="p">)))</span>
<span class="kp">max</span><span class="p">(</span>avbg.data<span class="p">)</span>

<span class="c1">################# 样品scale factor###################</span>
<span class="c1"># 如果scale factor的最大值与最小值的比值超过3倍的话</span>
<span class="c1"># 芯片结果也不好</span>
sfs.data <span class="o">=</span> <span class="kp">sort</span><span class="p">(</span>sfs<span class="p">(</span>qc.data<span class="p">))</span>
ratio <span class="o">=</span> <span class="kp">max</span><span class="p">(</span>sfs.data<span class="p">)</span> <span class="o">/</span> <span class="kp">min</span><span class="p">(</span>sfs.data<span class="p">)</span>
ratio

<span class="c1">################# 有表达的基因占比多少 ###############</span>
<span class="c1"># 表达基因占比太小表明芯片结果有问题</span>
per.data <span class="o">=</span> <span class="kp">as.data.frame</span><span class="p">(</span>percent.present<span class="p">(</span>qc.data<span class="p">))</span>
<span class="kp">min</span><span class="p">(</span>per.data<span class="p">)</span>

<span class="c1">################# 内参基因的表达占比 #################</span>
rat.data <span class="o">=</span> ratios<span class="p">(</span>qc.data<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>rat.data<span class="p">)</span>
</pre></div>


<h2 id="affy_1">三、使用Affy包处理原始芯片数据</h2>
<p>从原始芯片数据开始处理需要经过四个步骤：背景校正、归一化(标准化)、计算表达量、得到表达矩阵。你也可以通过使用mas5或rma或gcrma函数直接从读入的原始芯片数据(见2.1, the.data)计算表达量(见3.3),最后得到表达矩阵.</p>
<h3 id="31">3.1.背景校正</h3>
<div class="codehilite"><pre><span></span><span class="kp">suppressPackageStartupMessages</span><span class="p">(</span><span class="kn">library</span><span class="p">(</span>affy<span class="p">))</span>
<span class="kp">suppressPackageStartupMessages</span><span class="p">(</span><span class="kn">library</span><span class="p">(</span>simpleaffy<span class="p">))</span>
<span class="kp">load</span><span class="p">(</span><span class="s">&#39;GSE30668_eSet.RData&#39;</span><span class="p">)</span>
<span class="c1">################ rma, mas 两种校正方法###########################</span>
<span class="c1"># mas校正后pm和mm的值都被重新计算了</span>
<span class="c1"># rma校正仅针对pm,mm的值不会变化</span>
rma.data <span class="o">=</span> bg.correct<span class="p">(</span>the.data<span class="p">,</span> method<span class="o">=</span><span class="s">&#39;rma&#39;</span><span class="p">)</span>
mas.data <span class="o">=</span> bg.correct<span class="p">(</span>the.data<span class="p">,</span> method<span class="o">=</span><span class="s">&#39;mas&#39;</span><span class="p">)</span>
crt.data <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>rma.data<span class="p">,</span> mas.data<span class="p">)</span>
</pre></div>


<h3 id="32">3.2.归一化处理</h3>
<p>芯片的归一化方法有线性缩放法、非线性缩放法、分位数法、Cyclic loess法、Contrasts法。</p>
<div class="codehilite"><pre><span></span><span class="c1">#这里取rma背景校正的结果进行后续的归一化.</span>
data <span class="o">=</span> crt.data<span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
<span class="c1">############## 线性缩放 ############################</span>
<span class="c1"># 选择某个芯片作为参考,其他芯片与其分别做线性回归</span>
<span class="c1"># 得到的回归线对剩余其他芯片做缩放(同一缩放倍数)</span>

ln.data <span class="o">=</span> normalize<span class="p">(</span>data<span class="p">,</span> method<span class="o">=</span><span class="s">&#39;constant&#39;</span><span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>pm<span class="p">(</span>ln.data<span class="p">)</span><span class="o">/</span>pm<span class="p">(</span>data<span class="p">))</span>
<span class="kp">head</span><span class="p">(</span>mm<span class="p">(</span>ln.data<span class="p">)</span><span class="o">/</span>mm<span class="p">(</span>data<span class="p">))</span>
<span class="c1">############# 非线性缩放 ###########################</span>
<span class="c1"># 仅使用部分芯片结果做非线性拟合,然后进行缩放(不同缩放倍数)</span>
invar.data <span class="o">=</span> normalize<span class="p">(</span>data<span class="p">,</span> method<span class="o">=</span><span class="s">&#39;invariantest&#39;</span><span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>pm<span class="p">(</span>invar.data<span class="p">)</span><span class="o">/</span>pm<span class="p">(</span>data<span class="p">))</span>
<span class="kp">head</span><span class="p">(</span>mm<span class="p">(</span>invar.data<span class="p">)</span><span class="o">/</span>mm<span class="p">(</span>data<span class="p">))</span>
<span class="c1">############# 分位数(quantile) #####################</span>
<span class="c1"># 前提是假设每个芯片信号的经验分布函数一样</span>
<span class="c1"># 任两个芯片的QQ-plot会形成45度对角线</span>
qt.data <span class="o">=</span> normalize<span class="p">(</span>data<span class="p">,</span> method<span class="o">=</span><span class="s">&#39;quantiles&#39;</span><span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>pm<span class="p">(</span>qt.data<span class="p">)</span><span class="o">/</span>pm<span class="p">(</span>data<span class="p">))</span>
<span class="kp">head</span><span class="p">(</span>mm<span class="p">(</span>qt.data<span class="p">)</span><span class="o">/</span>mm<span class="p">(</span>data<span class="p">))</span>
<span class="c1">############# Cyclic loess #########################</span>
loe.data <span class="o">=</span> normalize<span class="p">(</span>data<span class="p">,</span> method<span class="o">=</span><span class="s">&#39;loess&#39;</span><span class="p">)</span>
<span class="c1">############# contrasts ############################</span>
cont.data <span class="o">=</span> normalize<span class="p">(</span>data<span class="p">,</span> method<span class="o">=</span><span class="s">&#39;contrasts&#39;</span><span class="p">)</span>
</pre></div>


<h3 id="33">3.3 计算表达量</h3>
<ul>
<li>使用affy::computeExprSet计算表达矩阵,它需要指定统计方法和PM校正方式</li>
</ul>
<div class="codehilite"><pre><span></span>################# 显示PM校正方式种类 #######################
pmcorrect.methods()
################# 显示统计方法种类 ##########################
generateExprSet.methods()
################# 计算表达矩阵 ######################
eSet.pmo.liw = computeExprSet(ln.data, pmcorrect.method=&#39;pmonly&#39;, summary.method=&#39;liwong&#39;)
</pre></div>


<ul>
<li>使用mas5或rma或gcrma函数一步到位</li>
</ul>
<div class="codehilite"><pre><span></span>eSet.mas5 = mas5(the.data)
eSet.rma = rma(the.data)
suppressPackageStartupMessages(library(gcrma))
eset.gcrma = gcrma(the.data)
</pre></div>


<h3 id="34">3.4 得到表达矩阵</h3>
<div class="codehilite"><pre><span></span><span class="c1">############### 进行rma或mas5处理 ###############</span>
<span class="c1">#eSet.mas5 = mas5(the.data)</span>
<span class="c1">#eSet.rma = rma(the.data)</span>
<span class="c1">############### 获取表达矩阵 ################</span>
<span class="c1"># 注意，rma法计算表达量</span>
expr.rma.lg2 <span class="o">=</span> exprs<span class="p">(</span>eSet.rma<span class="p">)</span>
expr.rma.nlg <span class="o">=</span> <span class="m">2</span><span class="o">^</span>expr.rma.lg2
expr.mas5.nlg <span class="o">=</span> exprs<span class="p">(</span>eSet.mas5<span class="p">)</span>
expr.mas5.lg2 <span class="o">=</span> <span class="kp">log2</span><span class="p">(</span>expr.mas5.nlg<span class="p">)</span>

<span class="c1">############### 筛选有表达的基因 ################</span>
<span class="c1"># mas5calls: P为present, A为absent, M为marginal</span>
eSet.calls <span class="o">=</span> mas5calls<span class="p">(</span>the.data<span class="p">)</span>
expr.calls <span class="o">=</span> exprs<span class="p">(</span>eSet.calls<span class="p">)</span>
probes <span class="o">=</span> <span class="kp">apply</span><span class="p">(</span>expr.calls<span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="kp">any</span><span class="p">(</span>x<span class="o">==</span><span class="s">&#39;P&#39;</span><span class="p">))</span>
<span class="c1"># 以rma为例</span>
expr.chose <span class="o">=</span> expr.rma.lg2<span class="p">[</span>probes<span class="p">,</span> <span class="p">]</span>
<span class="kp">save</span><span class="p">(</span>expr.chose<span class="p">,</span> file<span class="o">=</span><span class="s">&#39;GEO30668_expr_rma_chose.RData&#39;</span><span class="p">)</span>
</pre></div>


<h3 id="35">3.5 差异分析和注释</h3>
<p>差异分析可以使用limma直接对表达矩阵进行。注释的话，需要通过GEOquery得到的GPL文件中获取探针ID对应的基因ID。然后可以进行其他分析如富集分析、基因关联分析。</p>
		</content>

	</main>
	<footer>
		<p> Powered by xizhihui </p>
		<p> Thanks to <a href="https://www.hifreud.com/">hifreud</a> the theme is learned from his site. </p>
	</footer>

<script type="text/javascript" src="/js/index.json"></script>
<script type="text/javascript" src="/js/category.json"></script>
<script type="text/javascript" src="/js/tags.json"></script>
<script type="text/javascript" src="/js/about.json"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript">
	// listen to click event on navigator in header
	// document
	// 	.querySelector("div#head_right ul")
	// 	.addEventListener("click", change_page)
	var table = [['h2', '_1', '一、芯片基础'], ['h3', '11', '1.1 芯片平台和包'], ['h3', '12-bioconductor', '1.2 bioconductor包内置芯片数据'], ['h3', '13-geo', '1.3 GEO数据库'], ['h4', '131-geoquery', '1.3.1 GEOquery'], ['h4', '132-geo', '1.3.2 GEO页面'], ['h3', '14', '1.4 原始数据的预处理'], ['h2', 'affy', '二、使用Affy包分析芯片质量'], ['h3', '21-cel', '2.1 读取CEL文件,查看基本信息'], ['h3', '22', '2.2 查看芯片质量'], ['h2', 'affy_1', '三、使用Affy包处理原始芯片数据'], ['h3', '31', '3.1.背景校正'], ['h3', '32', '3.2.归一化处理'], ['h3', '33', '3.3 计算表达量'], ['h3', '34', '3.4 得到表达矩阵'], ['h3', '35', '3.5 差异分析和注释']]
	var html = format_article_table(table)
	var table_ele = document.querySelector("main #table")
	table_ele.innerHTML = html
	// window.onload = evt => resize_nav(table_ele)
	adaption(document, window)

</script>
</body>
</html>